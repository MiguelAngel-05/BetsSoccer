<ion-content>

  <!-- head -->
  <ion-header class="head">
  <ion-toolbar style="--background: linear-gradient(145deg, #1b0c0d, #140607); padding: 6px 12px;">

    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">

      <!-- titulo -->
      <ion-title style="font-weight: 800; letter-spacing: 0.5px; color: #fff;">
        FeisFut
      </ion-title>

      <!-- botones nav -->
      <div style="display: flex; gap: 12px;">
        <ion-button routerLink="/ranking" fill="clear" class="nav-btn">Ranking</ion-button>
        <ion-button routerLink="/liga" fill="clear" class="nav-btn">Liga</ion-button>
        <ion-button routerLink="/chat" fill="clear" class="nav-btn">Chat</ion-button>
      </div>

      <!-- avatar y botones -->
      <div style="display: flex; align-items: center; gap: 8px;">
        <ion-avatar (click)="goToProfile()">
          <img [src]="auth.user?.avatar || 'https://i.pravatar.cc/40'" />
        </ion-avatar>

        <!-- cerrar sesion -->
        <ion-button fill="outline" color="danger" (click)="logout()">
          Salir
        </ion-button>
      </div>

    </div>

  </ion-toolbar>
</ion-header>

  <!-- SEARCH -->
  <ion-searchbar
    [(ngModel)]="search"
    (ionInput)="applyFilters()"
    placeholder="Buscar equipo o partido">
  </ion-searchbar>

  <!-- FILTERS -->
  <div class="filters">
    <div class="chip" [class.active]="filter==='all'" (click)="setFilter('all')">Todos</div>
    <div class="chip" [class.active]="filter==='live'" (click)="setFilter('live')">üî¥ En vivo</div>
    <div class="chip" [class.active]="filter==='pending'" (click)="setFilter('pending')">‚è≥ Pr√≥ximos</div>
    <div class="chip" [class.active]="filter==='finished'" (click)="setFilter('finished')">‚úÖ Finalizados</div>
  </div>

  <!-- MATCHES -->
  <div class="matches">

    <ion-card *ngFor="let m of filteredMatches" class="match-card" 
              (click)="m.status === 'finished' ? goToMatchDetail(m) : showToast('El partido no ha terminado a√∫n')">

      <ion-card-header>
        <div class="match-top">
          <span class="league">Jornada &nbsp; {{ m.jornada }}</span>
          <span class="status" [class.live]="m.status==='live'">{{ m.status | uppercase }}</span>
        </div>
        <ion-card-title class="teams">
          <span class="equipo">{{ m.home }}</span> &nbsp; VS &nbsp; <span class="equipo">{{ m.away }}</span>
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <!-- SCORE -->
        <div class="score" *ngIf="m.status !== 'pending' || m.status==='live'">
          <span>{{ m.homeScore }}</span> : <span>{{ m.awayScore }}</span>
          <span *ngIf="m.status==='live'"> ({{ m.minute || 0 }}')</span>
        </div>

        <!-- PROGRESS BAR para partido en vivo -->
        <ion-progress-bar *ngIf="m.status==='live'" [value]="(m.minute || 0)/90" class="progress"></ion-progress-bar>

        <!-- EVENTOS DEL PARTIDO -->
        <div class="match-events" *ngIf="m.events?.length > 0">
          <div *ngFor="let ev of m.events" class="event">
            <span class="minute">{{ ev.minute }}'</span>
            <span *ngIf="ev.type==='goal'">‚öΩ {{ ev.team }}: {{ ev.player }}</span>
            <span *ngIf="ev.type==='yellow-card'">üü® {{ ev.team }}: {{ ev.player }}</span>
            <span *ngIf="ev.type==='red-card'">üü• {{ ev.team }}: {{ ev.player }}</span>
          </div>
        </div>

        <!-- BOT√ìN APOSTAR para partidos pendientes -->
        <div *ngIf="m.status==='pending'">
          <ng-container *ngIf="!hasBet(m.id); else myBet">
            <ion-button expand="block" color="danger" (click)="bet(m); $event.stopPropagation()">
              Porra
            </ion-button>
          </ng-container>
          <ng-template #myBet>
            <div class="my-bet">
              Tu porra: {{ hasBet(m.id)?.homeScore }} : {{ hasBet(m.id)?.awayScore }}
            </div>
          </ng-template>
        </div>

      </ion-card-content>
    </ion-card>

  </div>

</ion-content>